WITH CTE_COUNT AS (
SELECT artists.artist_name AS performer,
COUNT(songs.song_id) AS song_rank
FROM songs
JOIN artists ON songs.artist_id=artists.artist_id
JOIN global_song_rank ON songs.song_id=global_song_rank.song_id
WHERE global_song_rank.rank<=10
GROUP BY artists.artist_name
),
CTE_RANKED AS(
SELECT performer, song_rank, 
DENSE_RANK()OVER(ORDER BY song_rank DESC) as ranking
FROM CTE_COUNT
)
SELECT performer, ranking
FROM CTE_RANKED
WHERE ranking <=5
;
